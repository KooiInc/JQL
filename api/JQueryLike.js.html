<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>JQueryLike.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Helpers.html">Helpers</a><ul class='methods'><li data-type='method'><a href="module-Helpers.html#~time">time</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="CollectionLambdas.html">CollectionLambdas</a><ul class='methods'><li data-type='method'><a href="CollectionLambdas.html#.addClass">addClass</a></li><li data-type='method'><a href="CollectionLambdas.html#.assignAttrValues">assignAttrValues</a></li><li data-type='method'><a href="CollectionLambdas.html#.attr">attr</a></li><li data-type='method'><a href="CollectionLambdas.html#.clear">clear</a></li><li data-type='method'><a href="CollectionLambdas.html#.css">css</a></li><li data-type='method'><a href="CollectionLambdas.html#.empty">empty</a></li><li data-type='method'><a href="CollectionLambdas.html#.hide">hide</a></li><li data-type='method'><a href="CollectionLambdas.html#.remove">remove</a></li><li data-type='method'><a href="CollectionLambdas.html#.removeAttr">removeAttr</a></li><li data-type='method'><a href="CollectionLambdas.html#.removeClass">removeClass</a></li><li data-type='method'><a href="CollectionLambdas.html#.replaceClass">replaceClass</a></li><li data-type='method'><a href="CollectionLambdas.html#.setData">setData</a></li><li data-type='method'><a href="CollectionLambdas.html#.show">show</a></li><li data-type='method'><a href="CollectionLambdas.html#.styleInline">styleInline</a></li><li data-type='method'><a href="CollectionLambdas.html#.toggleAttr">toggleAttr</a></li><li data-type='method'><a href="CollectionLambdas.html#.toggleClass">toggleClass</a></li><li data-type='method'><a href="CollectionLambdas.html#.toggleStyleFragments">toggleStyleFragments</a></li></ul></li><li><a href="ExtendedNodelistLambdas.html">ExtendedNodelistLambdas</a><ul class='methods'><li data-type='method'><a href="ExtendedNodelistLambdas.html#.append">append</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.appendTo">appendTo</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.delegate">delegate</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.each">each</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.find">find</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.find$">find$</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.first">first</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.first$">first$</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.getData">getData</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.hasClass">hasClass</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.html">html</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.htmlFor">htmlFor</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.insert">insert</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.is">is</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.isEmpty">isEmpty</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.on">on</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.ON">ON</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.outerHtml">outerHtml</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.parent">parent</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.prop">prop</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.replace">replace</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.replaceMe">replaceMe</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.single">single</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.text">text</a></li><li data-type='method'><a href="ExtendedNodelistLambdas.html#.val">val</a></li></ul></li><li><a href="ExtensionHelpers.html">ExtensionHelpers</a><ul class='methods'><li data-type='method'><a href="ExtensionHelpers.html#.getAllDataAttributeValues">getAllDataAttributeValues</a></li><li data-type='method'><a href="ExtensionHelpers.html#.hex2Full">hex2Full</a></li><li data-type='method'><a href="ExtensionHelpers.html#.hex2RGBA">hex2RGBA</a></li><li data-type='method'><a href="ExtensionHelpers.html#.initializePrototype">initializePrototype</a></li><li data-type='method'><a href="ExtensionHelpers.html#.isVisible">isVisible</a></li><li data-type='method'><a href="ExtensionHelpers.html#.loop">loop</a></li></ul></li><li><a href="ExtensionHelpers_HandlerFactory.html">ExtensionHelpers/HandlerFactory</a><ul class='methods'><li data-type='method'><a href="ExtensionHelpers_HandlerFactory.html#.addListenerIfNotExisting">addListenerIfNotExisting</a></li><li data-type='method'><a href="ExtensionHelpers_HandlerFactory.html#.createHandlerForHID">createHandlerForHID</a></li><li data-type='method'><a href="ExtensionHelpers_HandlerFactory.html#.metaHandler">metaHandler</a></li></ul></li><li><a href="JQL.html">JQL</a><ul class='methods'><li data-type='method'><a href="JQL.html#.ExtendedNodeList">ExtendedNodeList</a></li><li data-type='method'><a href="JQL.html#.setStyle">setStyle</a></li><li data-type='method'><a href="JQL.html#.virtual">virtual</a></li></ul></li><li><a href="JQL_DOM.html">JQL/DOM</a><ul class='methods'><li data-type='method'><a href="JQL_DOM.html#.htmlToVirtualElement">htmlToVirtualElement</a></li></ul></li><li><a href="JQL_ExternalStyling.html">JQL/ExternalStyling</a><ul class='methods'><li data-type='method'><a href="JQL_ExternalStyling.html#.changeCssStyleRule">changeCssStyleRule</a></li></ul></li><li><a href="JQL_HTMLHelpers.html">JQL/HTMLHelpers</a><ul class='methods'><li data-type='method'><a href="JQL_HTMLHelpers.html#.setTagPermission">setTagPermission</a></li></ul></li><li><a href="JQL_HTMLHelpers_AllowUnknown.html">JQL/HTMLHelpers/AllowUnknown</a><ul class='methods'><li data-type='method'><a href="JQL_HTMLHelpers_AllowUnknown.html#.off">off</a></li><li data-type='method'><a href="JQL_HTMLHelpers_AllowUnknown.html#.on">on</a></li></ul></li><li><a href="JQL_Log.html">JQL/Log</a><ul class='methods'><li data-type='method'><a href="JQL_Log.html#.log">log</a></li><li data-type='method'><a href="JQL_Log.html#.setStyling4Log">setStyling4Log</a></li></ul></li><li><a href="JQL_Log_debugLog.html">JQL/Log/debugLog</a><ul class='methods'><li data-type='method'><a href="JQL_Log_debugLog.html#.hide">hide</a></li><li data-type='method'><a href="JQL_Log_debugLog.html#.isVisible">isVisible</a></li><li data-type='method'><a href="JQL_Log_debugLog.html#.off">off</a></li><li data-type='method'><a href="JQL_Log_debugLog.html#.on">on</a></li><li data-type='method'><a href="JQL_Log_debugLog.html#.show">show</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">JQueryLike.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// noinspection JSUnusedLocalSymbols,JSUnusedGlobalSymbols,JSUnresolvedFunction,JSValidateJSDoc

import {
  debugLog,
  log,
  setStyling4Log,
} from "./Log.js";

import {time,} from "./Helpers.js";

import {
  setTagPermission,
  allowUnknownHtmlTags,
} from "./DOMCleanup.js";

import {
  createElementFromHtmlString,
  element2DOM,
  insertPositions,
} from "./DOM.js";

import setStyle from "./Styling.js";

/* local ExtendedNodelist extendedNodeListCollectionExtensions */
import {initializePrototype,} from "./ExtensionHelpers.js";


// -------------------------------------------------------------------- //
export default (() => {
  /**
   * The JQL core
   * @namespace JQL
   */

  /**
   * The core constructor for creating and/or deliver a node(list), exposed as
   * &lt;code>JQL&lt;/code>
   * &lt;br>It delivers an instance of &lt;code>ExtendedNodeList&lt;/code> containing a collection of
   * &lt;code>HTMLElement&lt;/code>s (may be empty), for which a number of jquery-like extension methods is
   * available (e.g. &lt;code>[instance].&lt;b style="color:red">addClass&lt;/b>&lt;/code>).&lt;br>When the parameter
   * contains html (e.g. &lt;code>&amp;lt;p class="someClass">Hello wrld>&amp;lt;/p>&lt;/code>), the element(s) is/are
   * created and by default injected in de DOM tree unless [&lt;code>root&lt;/code>] is a &lt;code>HTMLBRElement&lt;/code>.
   * &lt;br>&lt;b>Note&lt;/b>: any html creation triggers checking and sanitizing the html to prevent script injection etc.
   * @param input One of&lt;ul>
   * &lt;li>&lt;code>Node&lt;/code> list
   * &lt;li>&lt;code>HtmlElement&lt;/code> instance
   * &lt;li>&lt;code>ExtendedNodeList&lt;/code> instance
   * &lt;li>&lt;code>string&lt;/code> css selector (e.g. &lt;code>'#someElem'&lt;/code>).&lt;br>
   * &lt;b>Note&lt;/b>: up to selectors level 3 for most modern browsers,
   *  maybe level 4 (draft) for more advanced browsers
   * &lt;br>(see selectors {@link https://drafts.csswg.org/selectors-3/ level 3}
   *  or {@link https://drafts.csswg.org/selectors-4/ level 4 draft})
   * &lt;li>&lt;code>string&lt;/code> html element string (e.g. &lt;code>'&amp;lt;div>Hello&amp;lt;/div>'&lt;/code>)
   * &lt;li>&lt;code>Array&lt;/code> of &lt;code>string&lt;/code>
   *  (e.g. &lt;code>['&amp;lt;span>Hello&amp;lt;/span>', '&amp;lt;span>world&amp;lt;/span>']&lt;/code>)
   * &lt;/ul>
   * @memberof JQL
   * @param root {HTMLElement} The root element to which an element to create must be appended or inserted into/before/after
   * (see [position] parameter)&lt;ul>
   * &lt;li>Defaults to &lt;code>document.body&lt;/code>
   * &lt;li>If one or more elements is/are created they will not be inserted into the DOM tree
   * when [root] is an instance of &lt;code>HTMLBRElement&lt;/code> (so &lt;code>&amp;lt;br>&lt;/code>)&lt;/ul>
   * @param position {string} Position within or before/after the root where the element must be injected
   * relative to [root]
   * - e.g. 'afterbegin' (or import and use insertPositions from DOM.js)
   * @returns {ExtendedNodeList} An instance of ExtendedNodeList
   * @example
   * import $ from "JQueryLike.js";
   * $(document.querySelectorAll(`p`));
   * $(document.querySelector(`p.something`));
   * $($(`.something`));
   * $(`.something`);
   * $(`&lt;p class="something" id="ex1">Hi. I am &lt;b>Groot&lt;/b>&lt;p>`);
   * $([`&lt;p class="something" id="ex2">Hi. I am &lt;b>Groot&lt;/b>&lt;p>`, `&lt;div id="Groot">Yup, aren't you?&lt;/div>`]);
   * // extensions (most are chainable)
   * $(`#ex1`).text(`. Say no more`, true).addClass(`done`);
   * $(`#Groot`)
   *   .css({color: `green`, fontWeight: `bold`})
   *   .html(`&lt;i>You are, really. And it's fine.&lt;/i>`, true);
   */
  const ExtendedNodeList = function (
    input,
    root = document.body,
    position = insertPositions.BeforeEnd) {

    // if not already existing create this constructors' prototype
    // from all methods exposed by [extendedNodeListCollectionExtensions]
    if (ExtendedNodeList.prototype.isSet === undefined) {
      initializePrototype(ExtendedNodeList);
    }

    this.collection = [];
    this.customStylesheetId = "JQLCustomCSS";
    const logLineLength = 75;
    this.cssSelector = input &amp;&amp; input.trim &amp;&amp; input || null;

    /**
     * Injects the collection to the DOM tree
     * @private
     * @param collection {...HTMLElement} array of &lt;code>HTMLElement&lt;/code>s (in memory),
     * i.e. the collection of the instance to return
     * @returns {Array} an Array of injected &lt;code>HTMLElement&lt;/code>s, maybe empty
     */
    const inject2DOMTree = collection =>
      root instanceof HTMLBRElement
        ? collection
        : collection.reduce((acc, elem) =>
          elem &amp;&amp; elem instanceof HTMLElement
            ? [...acc, element2DOM(elem, root, position)] : acc, []);
    const cleanup4Log = logLine =>
      logLine
        .trim()
        .substr(0, logLineLength)
        .replace(/>\s+&lt;/g, `>&lt;`)
        .replace(/&lt;/g, `&amp;lt;`)
        .replace(/\s{2,}/g, ` `)
        .replace(/\n/g, `\\n`) + (logLine.length > logLineLength ? `&amp;hellip;` : ``).trim();
    const ElemArrayHtml = elems => elems.filter(el => el).reduce((acc, el) => acc.concat(el.outerHTML), ``);
    const selectorRoot = root !== document.body &amp;&amp;
    (input.constructor === String &amp;&amp;
      input.toLowerCase() !== "body") ? root : document;

    try {
      if (!input) {
        // nothing to do, return the empty ExentedNodeList
        return this;
      }

      // input is one of ...
      if (input instanceof HTMLElement) {
        this.collection = [input];
        return this;
      }

      if (input instanceof NodeList) {
        this.collection = [...input];
        return this;
      }

      if (input instanceof ExtendedNodeList) {
        this.collection = input.collection;
        return this;
      }

      // determine what the input value actually is
      const isHtml = str =>
        str.constructor === String &amp;&amp;
        `${str}`.trim().startsWith("&lt;") &amp;&amp;
        `${str}`.trim().endsWith(">");
      const isArrayOfHtmlStrings = Array.isArray(input) &amp;&amp;
        !input.some(s => !isHtml(s));
      const isHtmlString = isHtml(input);
      const shouldCreateElements = isArrayOfHtmlStrings || isHtmlString;
      // show raw input in log
      const logStr = (`(JQL log) raw input: [${cleanup4Log(isArrayOfHtmlStrings ? input.join(``) : input)}]`);

      // the input is a css selector
      if (input.constructor === String &amp;&amp; !shouldCreateElements) {
        this.collection = [...selectorRoot.querySelectorAll(input)];
        log(`(JQL log) css querySelector [${input}], output ${this.collection.length} element(s)`);
        return this;
      }

      /*
       * the input is an Array of html strings
       * create elements from Array of Html strings
       * the elements to create are sanitized (by DOMCleanup)
       */

      if (isArrayOfHtmlStrings) {
        input.forEach(htmlFragment => {
          const elemCreated = createElementFromHtmlString(htmlFragment);

          if (elemCreated) {
            elemCreated.dataset.invalid &amp;&amp;
            document.body.appendChild(elemCreated.childNodes[0]) ||
            this.collection.push(elemCreated);
          }
        });
      }

      /*
       * the input is a html string
       * create elements from Html string
       * the element to create is sanitized (by DOMCleanup)
       */
      if (isHtmlString) {
        const nwElem = createElementFromHtmlString(input);
        if (nwElem) {
          const isInvalid = nwElem.dataset.invalid || nwElem.querySelector("[data-invalid]");
          this.collection = !isInvalid ? [nwElem] : this.collection;

          if (isInvalid) {
            nwElem.dataset.invalid &amp;&amp;
            document.body.appendChild(nwElem.firstChild) ||
            nwElem.querySelectorAll("[data-invalid]").forEach(el =>
              document.body.appendChild(el.firstChild));
          }
        }
      }

      if (shouldCreateElements) {
        // append collection to DOM tree (if the root is not &lt;br>)
        this.collection = inject2DOMTree(this.collection);
        log(`${logStr}\n  Created (outerHTML truncated) [${
          cleanup4Log(ElemArrayHtml(this.collection) || "sanitized: no elements remaining")
            .substr(0, logLineLength)}]`);
      }

    } catch (error) {
      const msg = `Caught jql selector or html error:\n${error.stack ? error.stack : error.message}`;
      log(msg);
      // ^ only if logStatus = on, so also
      console.log(msg);
    }
  }

  const JQL = (...args) => new ExtendedNodeList(...args);

  // assign static methods
  Object.entries({
    /**
     * Create an ExtendedNodeList instance without injecting elements (so, collection elements in memory)
     * &lt;code>JQL.virtual&lt;/code>,
     * @example
     * import $ from "JQueryLike.js";
     * const inMemoryParagraph = $.virtual(`&lt;p>I am and I am not&lt;/p>`);
     * // you won't see this in the DOM, but you can manipulate props
     * inMemoryParagraph.style({color: `green`}).setData({IAmGreen: `yep`});
     * $(`body`).append(inMemoryParagraph);
     * // result: &lt;p style="color:green" data-i-am-green="yep">I am and I am not&lt;/p>
     * //                                ^ Note: stringified output from the browser
     * // now, there it is
     * $(`&lt;div>Hello stranger. Try hovering me!&lt;/div>`).addClass(`something`);
     * @poram html {string} a HTML string e.g. &lt;code>&amp;lt;div class="hi">a div&amp;lt;/div>&lt;/code>
     * @returns {ExtendedNodeList} An instance of ExtendedNodeList
     * @memberof JQL
     */
    virtual: html => new ExtendedNodeList(html, document.createElement("br")),

    /**
     * Set style rules in the JQL custom stylesheet element
     * &lt;ul>&lt;li>The rules are written to a custom style sheet with id &lt;code>#JQLCustomCSS&lt;/code> into the document
     * &lt;li>You can use pseudo selectors. In case of creating a rule with the &lt;code>content&lt;/code> property
     * be sure to quote the text value (see example)&lt;/ul>
     * &lt;code>JQL.setStyle&lt;/code>,
     * @param selector {string} the selector e.g. &lt;code>#someElem.someClass&lt;/code>
     * @param ruleValues {Object} an object containing the rules for the selector
     * @example
     * import $ from "JQueryLike.js";
     * $.setStyle(`body`, {font: `normal 12px/15px verdana, arial`, margin: `2em`});
     * $.setStyle(`.something:hover:after`, {content: `' You hovered me!'`, color: `red`});
     * // usage
     * $(`&lt;div>Hello stranger. Try hovering me!&lt;/div>`).addClass(`something`);
     * @memberof JQL
     */
    setStyle: (selector, ruleValues) => setStyle(selector, ruleValues, JQL().customStylesheetId),

    /**
     * Activate/deactivate/show/hide (debug-)logging
     * &lt;code>JQL.log&lt;/code>,
     * see &lt;a href="./JQL_Log_debugLog.html">JQL/Log&lt;/a>
     * @memberof JQL
     */
    debugLog,

    /**
     * Log stuff to the logger (if active)
     * * &lt;code>JQL.log&lt;/code>,
     * see &lt;a href="./JQL_Log.html#.log">JQL/log&lt;/a>
     * @memberof JQL
     */
    log,

    /**
     * Allow/disallow the use of certain HTML tags when creating elements using JQL
     * &lt;code>JQL.setTagPermission&lt;/code>,
     * see &lt;a href="./JQL_HTMLHelpers.html#.setTagPermission">JQL/HTMLHelpers&lt;/a>
     * @memberof JQL
     */
    setTagPermission,

    /**
     * Allow/disallow unknown HTML tags
     * &lt;code>JQL.allowUnknownHtmlTags,&lt;/code>,
     * see &lt;a href="./JQL_HTMLHelpers_AllowUnknown.html">JQL/HTMLHelpers&lt;/a>
     * @memberof JQL
     */
    allowUnknownHtmlTags,

    /**
     * Positions for use in insertAdjacentHTML(-Element)
     * &lt;code>JQL.insertPositions&lt;/code>,
     * See &lt;a href="JQL_DOM.html">JQL/DOM&lt;/a>
     * @memberof JQL
     */
    insertPositions,

    /**
     * Set the styling for the logger element (&lt;code>#logBox&lt;/code>)
     * &lt;code>JQL.setStyling4Log&lt;/code>,
     * see &lt;a href="./JQL_Log.html#.setStyling4Log">JQL/Log&lt;/a>
     * @memberof JQL
     */
    setStyling4Log,

    /**
     * Current time helper
     * &lt;code>JQL.time&lt;/code>, see &lt;a href="module-Helpers.html#~time">Helpers.time&lt;/a>
     * @memberof JQL
     */
    time,
  }).forEach(([methodKey, method]) => JQL[methodKey] = method);

  return JQL;
})();</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Thu Sep 30 2021 12:03:34 GMT+0200 (Midden-Europese zomertijd) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
